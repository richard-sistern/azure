<!DOCTYPE html>
<html>

<head>
    <title>AZ-104 Cheat Deck</title>
    <link href="favicon.png" rel="icon" type="image/png" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <style type="text/css">
        @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
        @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
        @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

        body {
            font-family: 'Droid Serif';
        }

        h1,
        h2,
        h3 {
            font-family: 'Yanone Kaffeesatz';
            font-weight: normal;
        }

        .remark-code,
        .remark-inline-code {
            font-family: 'Ubuntu Mono';
        }
    </style>
</head>

<body>
    <textarea id="source">

class: center, middle

#AZ-104 Cheat Deck
---
# Device Management Cheat Sheet

**Device management** allows an organisation to manage laptops, desktops and phones that need access to cloud resources.
Device management is found under **Azure Active Directory (Azure AD)**.

The following join types are supported:

**Azure Registered**

- *Personally* owned devices
- Signed in with a local or personal account
- Windows 10, iOS, Android and MacOS

**Azure AD Joined**

- Devices owned by the organisation
- Signed in with an organisational account
- Access to devices that exist *only in the cloud* **(Cloud Native)**.
- Windows 10, Server 2019

---

**Hybrid Azure AD Joined**

- Devices owned by the organisation
- Signed in with Active Directory Domain Services account owned by the organisation
- Devices that exist in the cloud or *on-premise*
- Windows 7, 8.1, 10, Server 2008 +

**Mobile Device Management (MDM)**

Control the entire device, can wipe data from it, and also reset it to factory settings

**Mobile Application Management (MAM)**

Publish, push, configure, secure, monitor, and update mobile apps for your users

---

# Azure Roles

Role types:

- **Classic subscription administrator roles** - the original (depreciated)
- **Azure roles** - known as role-based access controls (RBAC), built on top of Azure Resource Manager
- **Azure Active Directory (Azure AD) roles** - used to manage Azure AD resources in a directory

**Identity Access Management (IAM)**

Allows you to create and assign Azure (RBAC) roles to users.

Roles restrict access to resource actions (known as operations). There are:

- BuiltInRole - Manage Microsoft roles are read only and pre-created
- CustomRole - Created by you with custom logic. Requires an *Azure AD Premium (P1 or P2)* license

**Role assignment** is when a role is applied to a user. This comprises a security principal, role definition and scope.

---

The built in roles are:

- Owner
- Contributor - (unable to grant)
- Reader
- User Access Administrator (grant only)

**Classic Administrators** have:

- **Account administrator** - billing owner of subscription, no access to Azure portal
- **Service administrator** - same access as user assigned the owner role at subscription scope. Full access to Azure
portal
- **Co-administrator** - same access as user assigned the owner role at the subscription scope

**Important Azure AD Roles**

- **Global Administrator** - full access to everything
- User Administrator - full access to create and manage users
- **Billing Administrator** - make purchases, manage subscriptions and support tickets

---

# Azure Policies

**Azure Policy** enforces organisation standards and assesses **compliance** at-scale.

Policies *do not restrict* access, they only observe for compliance.

Once a policy is assigned it will evaluate for the compliance state periodically.

The rules of a policy are described in a **policy definition** JSON file.

A **policy initiative** is group of policy definitions.

---
# Azure Resource Manager

**Azure Resource Manager (ARM)** is a service that allows you to *manage* Azure resources. It is a management layer that
allows you to:
- Create, update and delete resources
- Apply management features like access controls, locks and tags
- Write Infrastructure as Code (IaC) templates in JSON

ARM is a service layer and **spans multiple features and services**. For example, Subscriptions, Management Groups,
Resource Groups, Resource Providers, Resource Locks, Azure Blueprints, Resource Tags, access Control (IAM), Role-Based
Access Controls (RBAC), Azure policies, ARM Templates.

Think of Azure Resource Manager as a *gate keeper*. All *requests* flow through ARM and it decides whether that request
can be performed on a *resource*.

**Scope** is a **boundary of control** for Azure resources. It is a way to *govern* resources within a logical grouping
and apply restrictions in the form of rules.

- **Management Groups** are a logical grouping of multiple subscriptions
- **Subscriptions** grant access to Azure services based on a billing and support agreement
- **Resource Groups** represent a grouping of multiple resources
- **Resources** are an Azure service, eg. VM

---

An Azure account can have **multiple subscriptions** with the most common being Free Trial, Pay-As-You-Go and Azure for
Students.

**Resource Providers** are services within Azure. Some services are *registered* by default and others need to be
explicitly registered.

**Resource Tags** are *key/value pairs* that you can assign to Azure resources.

**Resource Locks** prevent accidental modification or deletion of resources at the subscription, resource group and
resource scope level. The following locks are available:

- **CanNotDelete** (Delete) - Authorised users can still read and modify a resource but are unable to delete the
resource
- **ReadOnly** (Read-only) - authorised users can read a resource but are unable to delete or update the resource

**Blueprints** enable *quick creation* of **governed subscriptions**. Nearly everything you would wish to include in an
Azure Blueprint deployment can be accomplished with an ARM template. Blueprints have a relationship between the
definition (what should be deployed) and the assignment (what was deployed).

---

# ARM Templates

**Infrastructure as Code (IaC)** is the process of *managing and provisioning* resources through machine-readable
*definition files* (eg. JSON) rather than physical hardware or interactive configuration tools.

These can be:

- **Declarative** - define what you want, get exactly that
- **Imperative** - define what you generally want, the service will guess the rest

**ARM templates** are *JSON files that define Azure resources* you wish to provision and configure. They are declarative
templates.

ARM template structure:

- **$schema** describes the properties that are available within a template
- **contentVersion** is a (user defined) version number for the template
- **apiProfile** avoids having to specify API versions for each resource in the template
- **parameters** are values you can pass to the template
- **variables** are used to transform parameters or resource properties using function expressions

---
- **functions** are user defined functions within the template
- **resources** define the resources to deploy or update
- **type** of the resource
- **apiVersion** defines the version of the REST API to use, each resource providers publishes its own API versions
- **name** of the resource
- **location** defines the region where the resource will be deployed
- **other properties** will vary per resource type
- **outputs** are values that are returned after deployment, used to chain templates

--- 

# Storage Accounts

Azure storage services:

- **Blob** - scalable *object store* for text and binary data. Supports big data analytics with Data Lake Storage Gen2
- **Files** - managed *file shares* for cloud and on-premises deployments
- **Queues** - schema less storage of structured data in a *NoSQL store*
- **Tables** - *messaging store* for messaging between application components
- **Disks** - *block level storage* volumes for Azure VMs

## Azure Blob Storage

Provides **standard** (HDD) and **premium** (SSD) performance tiers. Standard access tiers:

- Hot - frequent access, highest storage cost with lowest access cost
- Cool - infrequent access, store > 30 days. Lower storage cost with higher access cost
- Archive - rarely accessed, stored > 180 days. Lowest storage cost with highest access cost


---
Blob types:

- **Block** - stores text and binary data up to ~4.75TB
- **Append** - optimised for append operations, ideal for logging data
- **Page** - optimised for random access up to 8TB, stores virtual hard drive (VHD) files and serves Azure virtual
machine disks

Tiering:

- **Account level** - any blob that doesn't have an explicitly assigned tier infers its tier from the storage account
- **Blob level** - able to upload a blob to a tier of your choosing. Changing of tiers happens instantly, except when
moving out of archive

**Rehydrating a blob** can take server hours when moving from archive to another tier

**Blob lifecycle management**

You can create rule-based polices to transition data to different tiers. When a blob is moved to another tier it is
charged at the new tiers rate *immediately*.

Moving to a **cooler tier**:

---

- Operation billed as a *write operation* to the destination tier
- When the *write operation* (per 10,000) and data write (per GB) charges of the destination tier apply

Moving to a **hotter tier**:

- Operation billed as a read from the source tier
- When the *read operation* (per 10,000) and data retrieval (per GB) charges of the source tier apply
- Early deletion charges for any blob moved out of cool or archive tiers may also apply

**Early deletion** (cool and archive tiers) charges may apply:

- Cool tier (GPv2 only) has an early deletion period of 30 days
- Archive tier has an early deletion period of 180 days. The charge is prorated.

**Replication Types**

**Primary Region Redundancy** (disaster recovery and failovers)

---

- Locally Redundant Storage (LRS)
- Copies data synchronously in primary region
- Cheapest option
- Zone-redundant storage (ZRS)
- Copies data synchronously *across 3 AZs* in primary region

**Secondary Region Redundancy** (disaster recovery and failovers)

- Geo redundant storage (GRS)
- Copes data synchronously in primary region
- Copies data asynchronously to another region
- Geo-zone redundant storage (GZRS)
- Copies data synchronously *across 3 AZs* in primary region
- Copies data asynchronously to another region

Secondary Region **Redundancy with Read Access** (Read Replicas)


---
- Read-access geo-redundant storage (RA-GRS)
- Copes data synchronously in primary region
- Copes data synchronously to another region
- Read-access geo-redundant storage (RA-GZRS)
- Copes data synchronously in primary region
- Copes data synchronously to another region

## Azure Files

Azure Files is a fully managed *file share* in the cloud which can be mounted on a file system using SMB or NFS.

A file share can be backed up using *shared snapshots*, these are:

- Read-only and incremental with up to *200 snapshots* per file share. Backups can be retained for *up to 10 years*
- Backups are stored within the file share. If the share is removed, so are the backups

**Soft delete** prevents accidental deletion by retaining the data for a period of time before the final delete occurs.


---
**Storage Tiers**

- **Premium** - SSD with single-digit millisecond IO
- **Transaction optimised (standard)** - HDD for transaction heavy workloads which don't require the low latency of
Premium
- **Hot** - optimised for general purpose file sharing such as *team shares* and *Azure File Sync*
- **Cool** - HHD for cost-efficient online archive storage

**Storage Types**

- **General purpose version 2 (GPv2)** - HDD
- **FileStorage** - SSD

Identity can be managed with **on-premise**,**AD DS** or **Store Account Key** (account name/key)

Azure Files can be accessed anywhere via the storage account *public endpoint*.

**Encryption**


---
- Encrypted at rest using *Azure Storage Service Encryption (SSE)*
- **Encrypted in transit** with *SMB 3.0+ with encryption* or *HTTPS*

**Azure File Sync** is a service that caches Azure file shares on either *on-premise* Windows servers or *cloud* VMs

## **Uploading Data**

Methods to move data into Azure blob/file storage:

- **AzCopy** - command line tool
- **Azure Storage Data Movement library** - .NET library (backed by AzCopy)
- **Azure Data Factory** - ETL service
- **Blobfuse** - Linux file system driver
- **Azure Data Box** - physical transport of box of HDD
- **Azure Import/Export service** - own or Microsoft disks

**Azure Import/Export Service**


---
Can use own drives or Microsoft provided. Microsoft ships up to 5 encrypted SSDs (**Azure Data Box Disk**) with a 40 TB
total capacity per order.

Drives are prepared with the **WAImportExport (64-bit Windows only) tool**:

- Prepare your disk drives that are shipped for import
- Copying data to the drives
- Encryption of data with AES 256-bit BitLocker
- Generating journal files which are used during import
- Identifying the number of drives required for export jobs

The tool comes in two versions:

- **Version 1** for import/export into Azure Blob storage
- **Version 2** for import into Azure **files**

With export jobs:

- You can only export from Azure Blob

---
- You can ship up to 10 empty drives to Azure per job
- You create an export job and the data is loaded onto those drives and shipped back to you

## Shared Access Signature (SAS)

Proves are URL that grants restricted access rights to **Azure Storage** resources.

**Account level SAS**

- Access to resources in *one or more* storage services

**Service level SAS**

- Access to single storage account using the account key

**User delegation SAS (best practise)**

- Access to storage account using Azure AD credentials

---
- Limited only to Blob and Containers

A shared access signature comes in the following formats:

**Ad hoc SAS**

- Start, expiry times and permissions are part of the URI
- Any type of SAS can be an ad hoc SAS

**Service SAS with stored access policy**

- Stored access policy is defined on a resource container (limited to blob, table, queue or file share)
- Stored access policy can be associated to multiple SAS to manage constraints

--- 

# Virtual Machines 

**Azure Virtual machines (VMs)** allow you to create Linux and Windows virtual machines. These are billed at an **hourly
rate**.

The **size** of the virtual machine is determined by the image:

- vCPUs
- Memory
- Storage Capacity

A variety of sizes are available, there are geared towards specific use cases:

- General Purpose
- Compute Optimised
- Memory Optimise
- Storage Optimised
- GPU
- High Performance Compute

---

There is currently a limit of **20 VMs** per **region** in a **subscription**

A single VM has an availability of 99.9% (using premium disks only)

Two VMs in an *Availability Set* provide 99.95% availability

When you *launch* an Azure Virtual machine other networking components will either be created or associated to the VM:

- Network Security Group (NSG)
- Network Interface (NIC)
- Public IP Address
- VNet

You can *bring your own Linux* by creating a Linux Virtual Hard Disk (VHD)

The **Azure Compute Unit (ACU)** provides a way of comparing CPU performance across Azure VM sizes. The ACU is currently
based on a **Small (Standard_A1)** which is given a value of *100*. All other sizes then represent approximately how
much faster they run a standard benchmark.


---
VMs can be managed by the **Azure Mobile App**

## Connection

There are *3 ways* to connect to Azure Virtual Machines

### Secure Shell (SSH)

- Requires *port 22* via TCP
- RSA Key Pairs are commonly used to authorise access

### Remote Desktop Protocol (RDP)

- Allows remote connection to Windows machines
- Requires *port 3389* via TCP and UDP

### Azure Bastion


---
An Azure service you deploy which allows connection to virtual machines in a browser from the Azure portal. Supports
both SSH and RDP.

## Update Management

Allows you to **manage and install OS updates and patches** for both *Windows* and *Linux* machines in Azure, on-premise
and other cloud providers.

- Update Management performs a scan for update compliance
- A compliance scan is by default, performed **every 12 hours on *Windows*** and **every 3 hours on Linux**
- Results can take **30 minutes to 6 hours** to display in the dashboard
--- 
# Azure Disks

**Azure Managed Disks** are *block-level storage* and used with Azure VMs

## Overview

- Managed disks have *99.999%* availability. Azure creates *three replicas* of a disk.
- You can create up to 50,000 disks in a subscription per region.
- You can create up to 1,000 VMs in a virtual machine scale set.
- Managed disks are integrated with **availability sets**
- Managed disks support **availability zones**
- You can use **Azure Role Based Access Control (RBAC)** to assign specific permissions for a managed disk to users and
groups
- Virtual hard drive disks (VHD) can be **directly imported** into Azure disks
- **Azure Private Links** can be used to ensure traffic between Azure Disks and VMs stays within the Microsoft network
- **Azure Managed Disks** support the following encryption:
- Server Side Encryption (SSE)
- *Enabled by default* for all managed disks, snapshots, and images
- Temporary disks are *not encrypted* by SSE unless you enable encryption at host

---
- Keys can be managed within Azure (platform) or customer managed
- Azure Disk Encryption (ADE)
- Encrypts the **OS and Data disks** within an IaaS Virtual Machine
- On Windows, this uses **BitLocker**
- On Linux, this uses **DM-Crypt**

## Roles

There are 3 main disk roles in Azure, the **data disk**, the **OS disk** and the **temporary disk**

**Data Disk**

- Managed disk attached to a virtual machine to store application or other data
- Registered as a SCSI drive and labelled how you choose
- Maximum capacity of 32 GB
- The VM size determines the number of data disks you can attach and the type of storage available

**OS Disk**

---

- One attached to every VM
- Has a pre-installed OS, which is selected when the VM is created
- Contains the boot volume
- Maximum capacity of 4 GB

**Temporary Disk**

- Used by most VMs, not a managed disk
- Provide short-term storage for applications and processes, and is intended to only store data such as page or swap
files
- Data may be lost during a maintenance event or when you redeploy a VM
- Data persists during a standard reboot of the VM
- Typically mounted to /dev/sdb on Linux and D on Windows
- Not encrypted by SSE unless encrypt at host is enabled

## Backup

**Azure backup** can be used with schedules and backup retention polices

---

To backup single disks, use a *managed disk snapshot*. For multiple disks, use a *managed custom disk*

A **managed disk snapshot** is a *read-only crash-consistent full copy of a managed disk* that is stored as a standard
managed disk by default. Snapshots:

- Are point in time recovery
- Exist independent of the source disk and can be used to create new managed disks
- Billed based on used size of the drive
- Usage size can be found in the Azure usage report

A **managed custom image** creates an image containing **all managed disks** associated with a VM

## Tiers

**Ultra Disks** (high throughput, I/OPs and consistent low latency)

- able to dynamically change performance, without a VM restart
- can only been used as *data disks*

---

**Premium SSD** (high performance and low latency)

- can only be used with a VM sizes that are premium storage compatible
- guaranteed IOPS
- meets low single digit ms latency with target IOPS/throughput 99.9% of the time

**Standard SSD** (cost effective, consistent performance at lower IOPS levels)

- no guaranteed IOPS
- available on all Azure VMs

**Standard HDD** (lowest cost for latency insensitive workloads)

- no guaranteed IOPS
- available on all Azure VMs

###

---

# Application Gateway

**Azure Application Gateway** is an *application-level routing* and *load balancing* service which operates on **OSI
Layer 7** (application layer).

**Azure Web Application Firewall (WAF)** policies can be attached to an Application Gateway to provide additional
security.

An Application Gateway comprises:

- **Frontends** with a choice of address type:
- **Private IP** (internal load balancer)
- **Public IP** (public/external load balancer)
- **Backends** (pools)
- Collection of resources where your application gateway sends traffic
- Can contain, VMs, VM scale sets, IP addresses, domain names, App Service
- **Routing Rules** which are composed of **Listeners, Backend targets, HTTP settings**
- **Listeners** listen to on a specific port and IP address for traffic that uses a specified protocol
- If criteria are met, the application gateway will apply this routing rile
- **Basic** listeners forward all requests for any domain to backend pools

---
- **Multi-site** listeners forward requests to different backend pools based on *host header* and *host name*
- Requests are matched according to the **order of the rules** and type of listener. Add basic listeners last, otherwise
it will capture all requests
- **Backend targets** choose where a route should go, either **Backend Pool** or **Redirection**
- To create a rule for Backend Pool, you need to create an **HTTP Setting**
- HTTP Settings define how to handle cookies, connection draining, port request time out, etc.
---
# Scale Sets

Azure Scale Sets allow you to **automatically** *increase* or *decrease* VM capacity. Often associated with a **Load
Balancer** to:

- Evenly distribute across multiple Availability Zones
- Use probe checks for more robust health checks

The following load balancers can be used:

- **Application Gateway** is an **HTTP/HTTPS** web traffic load balancer and application firewall
- **Azure Load Balancer** supports **TCP/UDP** traffic, port-forwarding and outbound flows

A **Scaling Policy** determines when a VM should be added or removed

- **Scale Out** *adds* an instance to the scale set to *increase* capacity
- **Scale In** *removes* an instance from the scale set to *decrease* capacity

**Scale-In Policy** determines how a VM is removed (deleted) to decrease capacity

---

- **Default** - delete the VM with the highest instance ID, balanced across Availably Zones (AZs) and Fault Domains
(ADs)
- **Newest VM** - balanced across Availably Zones (AZs)
- **Oldest VM** - balanced across Availably Zones (AZs)

**Update Policy** determines how VM instances are brought up-to-date with the latest scale set model

- **Automatic** - start upgrading immediately in random order
- **Manual** - existing instances must be manually upgraded
- **Rolling** - upgrades roll out in batches with optional pause

**Health monitoring** determines if a service is *healthy* or *unhealthy*

- **Application health extension** requests a page over HTTP and expects a status of 200
- **Load balancer probe** checks based on TCP, UDP or HTTP requests

**Automatic repair policy** - if an instance is unhealthy then delete and launch a new instance
---
# Azure App Services

The **Azure App Service** is a Platform as a Service (PaaS) which provides **HTTP** hosting for web applications, REST
APIs and mobile back ends. The App Service makes it easy to implement:

- Azure DevOps (for deployments)
- GitHub integration
- Docker Hub integration
- Package Management
- Staging environments
- Custom domains
- Attaching TLS/SSL certificates

Pay based n the Azure App **Service Plan**:

- **Shared Tier** - Free, Shared (**Linux not supported**)
- **Dedicated Tier** - Basic, Standard, Premium, Premium V2, Premium (V3)
- **Isolated Tier**


---
The following runtimes are supported on either **Windows** or **Linux**:

- .NET/.NET Core
- Java
- Ruby
- Note.js
- PHP
- Python

The service can also be used to run **Docker** single or multi instance containers. **Custom containers** are supported,
simply create Docker file, upload to Azure Container Registry and deploy.

**Deployment Slots** allow the creation of *different environments* for the web application. These environments can be
**swapped**, for example, a Blue/Green deploy.

**WebJobs** allow you to run a program or script in the same instance as a web, API or mobile app,

**App Service Environment** (ASE) provides a *fully isolated and dedicated environment* for securely running App Service
apps at high scale. Multiple ASEs can be created:

- within a single region

---
- across multiple regions

ASEs are ideal for *horizontally scaling stateless application tiers* in support of *high requests per second (RPS)
workloads*.

Features of ASE:

- own pricing tier (Isolated)
- can be used to configure security architecture
- can have app access gated by upstream devices, such as web application firewalls (WAFs)
- can be deployed into Availability Zones (AZ) using zone pinning
- two deployment types:
- External ASE
- Internal Load Balancer (ILB) ASE
---
# Azure Monitor

Azure Monitor collects, analyses and acts on telemetry from your cloud and on-premises environments.

- Create dashboards
- Smart alerts
- Automated actions
- Log monitoring

To achieve observability, you need to combine **Metrics**, **Logs** and **Traces**

- **Metrics** - a value measured over a period of time
- **Logs** - a text file of time series event data
- **Traces** - history of a request that travels through multiple apps/services. Used to pinpoint performance issues or
failure

Azure Monitor collects **Log** and **Metric** data from sources.

**Azure Monitor Logs** (log and performance data)

---

- Data logs are consolidated from different sources into **workspaces**
- Platform logs from Azure services
- Log and performance data from virtual machine agents
- Usage and performance data from applications
- Analysis performed using **Kusto Query Language (KQL)**
- Work with log queries and their results interactively using **Log Analytics**

**Azure Monitor Metrics** (numeric data in a **time series database**)

- Metrics a numerical vales collected at regular intervals and describe some aspect of a system at a particular time
- Lightweight and capable of supporting near real-time scenarios, useful for alerting a fast detection of issues
- Analyse interactively with **Metrics Explorer**

**Log Analytics** is a tool to **edit and run log queries** using KQL with data in **Azure Monitor Logs**

**Log Analytics Workspaces** are unique environments for Azure Monitor log data. Each workspace has its own data
repository and configuration, data sources and solutions are configured to stare their data in a workspace.


---
**Azure Monitor Logs** are based on Azure Data Explorer and log queries are written in KQL.

**Kusto Query Language (KQL)**

- Can be used in , Log Analytics, Log Alert Rules, Workbooks, Azure Dashboards, Logic Apps, PowerShell, Azure Monitor
Logs API
- Based on relational database management systems and supports entities such as *databases, tables* and *columns*
- Query operators include calculated columns, searching and filtering on rows, group by aggregates, join functions
- Kusto queries execute in the context of a **Kusto database** attached to a *Kusto cluster*
- Kusto is generally composed of entities:
- **Clusters** - holds databases
- **Databases** - holds tables and stored functions
- **Stored functions** - allows reuse of Kusto queries or query parts
- **Tables** - holds data
- **Columns** - scalar data types
- **External tables** - reference data stored outside of the Kusto database

**Metrics Explorer** is a sub-service of Azure Monitor that allows you to *plot charts, visualise correlating trends and
investigate spikes and dips* in **metrics values**. The visualise a metric you have to define:


---
- **Scope** - select *resource(s)
- **Namespace** - specific group of metric data within a resource
- **Metric** - the value you wish to visualise
- **Aggregates** - how to group values in the final output

**Alerts** notify when issues are found within the infrastructure or application

- Allows you to *identify and address* issues before users of the system notice them
- Alert types:
- Metric Alerts
- Log Alerts
- Activity Log Alerts

**Azure Dashboards** are virtual workspaces to *quickly launch tasks for day-to-day operations and monitor resources*

**Azure Workbooks** provide a flexible *canvas for data analysis* and the creation of rich visual reports within the
Azure portal. They tell a *story* about the performance and availability of applications and services.

**Application Insights** is an **Application Performance Management (APM)** service, which is itself a sub-service of
Azure Monitor:

---

- automatically detect performance anomalies
- includes analytics tools to help diagnose issues and understand what users do in an app
- designed to help contiguously improve performance and usability
- works for .NET, Node.js, Java and Python hosted on cloud, hybrid, AWS, etc.
- integrates into DevOps processes
- can monitor and analyse telemetry from mobile apps by integrating with Visual Studio App Centre

To use Application Insights **you have to instrument your application**

- install the instrument package (SDK), or enable Application Insights using the Application Insights Agents, where
supported
- Apps can be instrumented from anywhere
- When Application Insights is configured for a web app, an Application Insights *resource* is created in Azure
- This resource is used to view and analyse telemetry collected from the app
- The resource is identified by an *instrumentation key* (ikey)

---

# Azure Backup

**Azure Backup Service** is a backup layer that spans many azure services. This has started to be centralised into
*Backup Centre*.

- On-premise, Azure VMs, Azure Files, SQL Server (via Azure VM), SAP HANNA (via Azure VM), Azure Database for PostgreSQL
- Azure backup is *directly integrated* with Azure Services, you wont find it based on service name
- Offloads on-premise backups
- Backs up VMs
- Scales easily
- Provides unlimited data transfer (no limit and no charge)
- Built in security at test and in transit
- Centralised monitoring and management
- App consistent backups
- Automatic storage management
- Multiple storage options

**Azure Recovery Services (ARS) vault** is a **storage entity** in Azure that contains *data* and *recovery points*
created over time.


---
- Enhanced capabilities to help secure backup data
- Central monitoring for a hybrid environment
- Azure role-based access control (RBAC)
- Soft delete
- Cross region restore

Microsoft Azure Recovery Services (MARS) agent backs up *files*, *folders* and *system state* from Windows *on-premise*
machines and *Azure VMs*

- Backups are stores in a Recovery Services vault in Azure
- The MARS agent is also knows as the Azure Backup agent
- The MARS agent does not support Linux operating systems
- **Azure Site Recovery (ASR)** his a *hybrid* (on-premise to cloud) backup solution for **site-to-site
recovery****Azure Container Instances (ACIs)** is designed to run isolated containers for

- simple applications
- task automation
- build jobs

Containers

- can be previsioned *within seconds*
- are *billed per second*
- have *granular and custom sizing of vCPUs, Memory and GPUs*
- be *Linux* or *Windows*
- can *persist storage with Azure files*
- accessed via a FQDN, for example, label.azureregion.azurecontainer.io

**Container Groups** are collections of containers that are scheduled on the same host machine.

- Containers in a group share lifecycle, resources, local network and storage volumes

---
- A little similar to a Kubernetes pod
- Multi-container groups currently support Linux only

A multi-container group can be deployed with:

- **Resource Managers Templates (ARM template)** - when you have to deploy additional Azure service resources
- **YAML files** - deploying container instances only

A **container restart policy** specifies what a container should do when their process has completed.

- **Always** (default) - container are *always restarted*. Suited to long running tasks such as web servers
- **Never** - *run once only*. Suited to one off tasks like background jobs
- **On Failure** - containers that encounter an error

**Azure Containers** are *stateless* by default. When a container crashes or stops, all state is lost. To persist state
external storage has to be *mounted*.

- Azure files (file share)
- Secret volume

---
- Empty directory
- GIT repo

Azure CLI commands

```shell
# pull logs
az container logs

# diagnostic informatonduring container startup
az container attach

# interactive container run
az container exec

# list metrics such as CPU usage
az monitor metrics list
```

---

# Azure Container Registry

**Azure Container Registry (ACR)** is a managed , private **Docker registry service** based on the *open-source Docker
Registry 2.0*

Use **Azure Container Registries** with existing container development and deployment pipelines.

Use **Azure Container Registry Tasks** to build container images in Azure.

Pull images from an Azure container registry to various *deployment targets*:

- Kubernetes
- DC/OS
- Docker Swarm

**Azure Container Registry (ACR) Tasks** can *automate OS and framework patching* of Docker containers.

- You can *trigger automated* builds with:
- Source code updates

---
- updating a containers base image
- timers on a schedule
- You can create *multi-step* tasks
- Each ACR task has an associated *source code context*
- Tasks can use *run (environment) variables*
---
# Azure Kubernetes Service 

**Azure Kubernetes Service (AKS)** deploys *managed Kubernetes clusters*. Azure will manage:

- Kubernetes masters
- Health monitoring
- Maintenance

The AKS service is free. You only have to pay for the agent nodes, which you maintain.

AKS should be used when you require **full container orchestration**:

- service discovery across multiple containers
- automatics scaling
- co-ordinated application upgrades
- **Bridge to Kubernetes** is an **extension** in *Visual Studio* that allows developers to write, test and deploy
microservice code on their development workstations.



---

# Azure DNS 

**Azure DNS** is a *hosting service* for *DNS domains* that provides name resolution using Microsoft Azure
infrastructure. You can't use Azure DNS to buy a domain name.

**Public DNS** (internet facing)

- Manage domains for internet accessible domains
- Pointing your domain to you website
- Setting records to prove you own the domain
- Records to connect you domain to your email server

**Private DNS** (internal facing)

- Allows use of custom domains instead of the Azure provided ones

**DNS Zone** is a container for all of the DNS records for a specific domain name

**DNS Record** hold rules of where to direct traffic. A record is composed of *name*, *type* and *value*:

---

- **A (address)** - point to an IPv4 address
- **AAAA** - point to an IPv6 address
- **CAA (Certificate Authority)** - records who can issue certificates for a domain
- **CNAME (Canonical Name)** - alias from one domain to another
- **MX (Mail Exchange)** - records point to mail servers
- **NS (Name Server)** - records identify multiple DNS serves for a domain. Provides fault tolerance
- **PTR (Pointer)** - records point to a domain or host name but used for reverse DNS lookup
- **SRV (Service)** - records are used to identify computers that host specific services, live locating a DC for AD
- **TXT (Text)** - records are just text, used for documentation and verification
- **SOA (Start of Authority)** - records contain administrative details about a domain

An **Alias** is a *special record type* in Azure which works with **A**, **AAAA** and **CNAME** records. The Azure Alias
record points to an Azure resource instead of an IP or hostname. This **helps avoid dangling domains**.

**Record Set** is a group of records. Azure always creates a records set, even for a single record.

**Tile to Live (TTL)** indicates how long a value should be cached by clients

---
# Azure Networking 

**Virtual Network (vNet)** is a logically isolated section of the Azure Network, where you can launch resources.

**vNet Peering** (connect multiple vNets to act as one network)

- **Regional** peers two vNets in the same region
- **Global** peers two vNets from different regions

**Azure Network Interfaces (NICs)**

- Attached to a VM instance
- Without a NIC, a VM has no way to communicate
- An Azure VM instance has to have one NIC but can have more

**Route Table** is a table of data stored in router or network host which lists routes to next destinations

- Azure automatically creates a route table with default routes (system routes) and associates them to subnets

---
- The *system routes* can be overridden by creating a new route table and associating it with a subnet

**Address Space** denotes *a range of available IP address* that are allocated to using within a vNet. The amount of
addresses available is determined by the CIDE notation.

**Subnet** is a *logical division of an address space*

- Requires a route table for access
- Public and private subnet describes where a subnet is reachable from the internet or not
- Azure **has no concept of private and public subnets**. You have to configure subnets to ensure they do not reach the
internet
- You can associate an NSG to protect traffic entering and leaving a subnet
- Azure has a special type of Gateway Subnet, used by **Azure Virtual Network Gateway**

**Azure Private Links** provides a *secure connection* between Azure resources so traffic *remains within the Azure
Network*.

- **Private Link Endpoint** is a *network interface* that connects to a service powered by Azure Private Link. This uses
a private IP address from you vNet
- **Private Link Service** allows you own workloads to connect to a private link. This requires an *Azure Standard
Internal Load Balancer* to be associated with the link service
- Many Azure services (Storage, CosmoDB, SQL) can work with private link and also third party providers


---
**Azure Firewall** is a managed *cloud-based network security service* that protects *Azure vNet* resources

- Full stateful Firewall as a Service (FWaaS)
- Can centrally *create*, *enforce*, and *log* application and network connectivity polices across subscripts and
virtual networks
- Uses a *static public IP address* for vNet resources, allowing outside firewalls to identify traffic originating from
your virtual network
- Fully integrates with **Azure Monitor** for logging and analytics
- Launches on its own vNet. Other vNets pass through this central vNet
- Has **Microsoft Threat Intelligence** which blocks known malicious IPs and FQDNs

**Azure ExpressRoute** creates *private connections* between Azure datacentres and infrastructure on premise or in a
colocation environment. Connectivity is provided though a provider ad a colocation facility and can be any-to-any (IP
VPN), point-to point Ethernet network and virtual cross-connection

**ExpressRoute Direct** provides *greater bandwidth connections* from 50 Mbps to 10Gbps# Azure Network Watcher Cheat
Sheet

**Azure Network Watcher** provides tools to *monitor, diagnose and view network metrics*. You can also enable/disable
logs for resources in an Azure vNet.

- IP Flow Verify
- Packet Capture
- Troubleshoot VPNs
- NSG Flow Logs
- Diagnostic Logs
- Traffic Analytics
- NPM

Watcher *can* monitor and repair Azure resources you provision such as Virtual Machines, virtual Networks, Application
Gateways and Load Balancer.

Network Watche**r**

- **Cannot** be used to monitor PaaS (filly managed services) or Web Analytics
- Is **disabled by default** in most regions and must be enabled at a per region basis

---
- Can **visualise** the topology of you vNets

**Network Performance Monitor (NPM)** is a *cloud-based hybrid network monitoring solution* that helps monitor network
performance between various points in a network infrastructure.

- Traffic blackholing
- Routing errors
- Unconventional network issues
- Generates alerts and notifies you when a threshold is breached for a network link# Azure Network Security Group Cheat
Sheet

**Network Security Group (NSG)** filters network traffic to and from Azure resources in a vNet.

An NSG comprises many **Security Rules**

- **Name** - A unique name within the NSG
- **Source or destination** - An IP address or CIDR block, service tag or application security group
- **Port Range** - Specify a single or range of ports
- **Protocol** - TCP, UDP, ICMP or ANY
- **Action** - Allow or Deny
- **Priority** - A number between 100 and 4096 (lower number, higher priority)

Azure will set default inbound and outbound rules for you.

You cannot create two security rules with the same priority and direction.

You may have 5000 NSGs per subscription with 1000 rules per NSG.

---

The flow record allows a network security group to be stateful.

If you specify an outbound port, you don't need to set the inbound port since it will be set for you. The opposite is
also true.
---
# Azure Virtual WAN 

**Azure Virtual WAN** is a *consolidated networking service* that covers most networking, security and routing
functionality in a single interface. This includes:

- Branch connectivity (via connectivity automation from Virtual WAN Partner devices such as SD-WAN or VPN CPE)
- Site-to-site VPN connectivity
- Remote user VPN (point-to-site)
- Private ExpressRoute connectivity
- Intra-cloud connectivity (transitive connectivity for virtual networks)
- VPN ExpressRoute inter-connectivity
- Routing
- Azure Firewall encryption for private connectivity

The Azure Virtual WAN itself is a **Software Defined WAN (SD-WAN)** and is a better way to route to branches,
datacentres, vNet and cloud services than MPLS.

A *Point of Presence (PoP)* is an entry at the edge of a network, for example, an ISP datacentre.

A *Hop* is when you change networks

---

**Multi-Protocol Label Switching (MPLS)** is a method of packet forwarding, where instead of using IP and layer 3
information to make forwarding decisions an *MPLS label* is used to determine the shortest route to an end destination.

**Software Defined WAN (SD-WAN)** decouples CPU intensive tasks from routers such as the management, operations and
control planes that can now be controlled in a central location remotely and virtually at your headquarters.

- Replaces MPLS, so you traverse the internet instead of a private network
- More cost effective and requires less configuration than an MPLS initially and at scale
- Secure because it used HTTPS as supported by your ISP
---
# Azure Virtual Network Gateways

A VPN *extends a private network across a public network* and enables users *to send and receive data across shared or
public networks* as if their computing devices were directly connected to the private network.

A **virtual network gateway** is the software VPN device for the Azure virtual network. When you deploy a VNG:

- Two or more specialised VMs are deployed in a specific subnet called *"gateway subnet"*
- These VMs contain routing tables and run specific gateway services
- You will choose a **Gateway Type** to specify **VPN** or **ExpressRoute**

When creating a VPN gateway, you are generally designing for one of the following topologies:

- **Site-to-Site (S2S)** - connect Azure to an on-premise datacentre
- **Multi-Site** - connect Azure to multiple on-premise datacentres
- **Point-to-Site (P2S)** - connect Azure to multiple individual computers
- **vNet-to-vNet** - connect two vNets in different regions, subscriptions or deployment models
---
# Azure Active Directory Cheat Sheet

**Active Directory (AD)** is Microsoft's *identity and access management service*.

**Azure Active Directory (Azure AD)** is Microsoft's cloud-based version of AD. *Identity as a Service (IDaaS)*.

Azure AD versions:

1. **Free** - MFA, SSO, Basic Security and Usage Reports, User Management
2. **Office 365 Apps** - Company Branding, SLA, Two-Sync between On-Premise and Cloud
3. **Premium 1 (P1)** - Hybrid Architecture, Advanced Group Access, *Conditional Access*
4. **Premium 2 (P2)** - Identity Protection, Identity Governance

Azure AD can *authorise* and *authenticate* to multiple sources:

- On-premise AD via **Azure AD Connect**
- Web applications via **App Registrations**
- Allow login with IpD (e.g.. Facebook or Google) via **External Identities**

---
- Office 365 or **Azure Microsoft**

A **tenant** *represents and organisation* in Azure AD. A tenant is a dedicated Azure AD Service instance which is
automatically created when you sign up for either Microsoft Azure, Microsoft Intune, Microsoft 365.

Each Azure AD tenant is distinct and separate from other Azure AD tenants.

When performing a lift-and-shift of AD to Azure, not all AD features are supported and in that case you need to use AD
DS. **Azure Active Directory Domain Services (AD DS)** provides managed domain services, such as:

- Domain joins
- Group polices
- LDAP
- Kerberos and NTLM authentication

**Azure AD Connect** provides the following:

- **Password hash synchronisation** - sign-in method, synchronises a hash of users on-premise AD password with Azure AD
- **Pass-through authentication** - sign-in method, allows users to use same password on premises and in the cloud
- **Federation integration** - hybrid environment using an on-premises AD FS infrastructure, for certificate renewal

---
- **Health monitoring** - monitors and provides a central location in the Azure portal to view activity

Azure AD has two kinds of users:

- **Users** - belongs to your organisation
- **Guest Users** - belongs to another organisation

**Request to Join Groups**

The group owner can let users find their own groups to join, instead of assigning the. The owner can set the group to
automatically accept all users or require approval.

The are **four ways** to *assign resource access rights* to users:

- **Direct assignment** - The resource owner directly assigns the user to resource
- **Group assignment** - The resource owner assigns an Azure AD group to the resource
- **Rule-base assignment** - The resource owner creates a group and users a rule to define which users are assigned to a
specific resource
- **External authority assignment** - Access comes from an external source, such as an on-premises directory or a SaaS
app


    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create();
    </script>
</body>

</html>